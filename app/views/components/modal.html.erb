<%= render Ui::ComponentHeaderComponent.new(
  title: "Modal 对话框",
  description: "模态对话框。",
  when_to_use: [
    "需要用户处理事务，又不希望跳转页面以致打断工作流程时。",
    "需要一个简洁的反馈信息时。",
    "当需要用户进行一个确认操作时。"
  ]
) %>

<%= render Ui::ExampleComponent.new(
  title: "基本用法",
  description: "点击按钮打开对话框。",
  language: :erb,
  code: modal_basic_code
) do %>
  <button onclick="document.getElementById('my-modal').ant_modal_controller.open()" 
          class="px-4 py-2 bg-[#1677ff] text-white rounded hover:bg-[#4096ff] transition-colors">
    Open Modal
  </button>

  <%= ant_modal(title: "Basic Modal", id: "my-modal", open: false) do %>
    <p>Some contents...</p>
    <p>Some contents...</p>
    <p>Some contents...</p>
  <% end %>
<% end %>

<%= render Ui::ExampleComponent.new(
  title: "自定义页脚",
  description: "使用 footer slot 自定义按钮。",
  language: :erb,
  code: modal_custom_footer_code
) do %>
  <button onclick="document.getElementById('custom-footer-modal').ant_modal_controller.open()" 
          class="px-4 py-2 bg-[#1677ff] text-white rounded hover:bg-[#4096ff] transition-colors">
    Custom Footer
  </button>

  <%= ant_modal(title: "Custom Footer", id: "custom-footer-modal") do |modal| %>
    <% modal.with_footer do %>
      <%= ant_button "Return", type: :default, onclick: "document.getElementById('custom-footer-modal').ant_modal_controller.close()" %>
      <%= ant_button "Submit", type: :primary, onclick: "document.getElementById('custom-footer-modal').ant_modal_controller.close()" %>
      <%= ant_button "Search on Google", type: :dashed, onclick: "window.open('https://google.com')" %>
    <% end %>
    <p>Modal content...</p>
  <% end %>
<% end %>

<%= render Ui::ExampleComponent.new(
  title: "异步关闭",
  description: "点击确定后异步关闭对话框，例如提交表单。",
  language: :erb,
  code: modal_async_code
) do %>
  <button onclick="openAsyncModal()" class="px-4 py-2 bg-[#1677ff] text-white rounded hover:bg-[#4096ff] transition-colors">
    Async Modal
  </button>

  <%= ant_modal(title: "Async Operation", id: "async-modal") do %>
    <p>Click OK button to simulate an async operation...</p>
  <% end %>

  <script>
  function openAsyncModal() {
    const modal = document.getElementById('async-modal').ant_modal_controller;
    modal.open();
    
    // Listen for OK button click
    document.getElementById('async-modal').addEventListener('ant--modal:ok', async (event) => {
      event.preventDefault(); // Prevent default close behavior
      
      modal.setConfirmLoading(true);
      
      // Simulate async operation
      await new Promise(resolve => setTimeout(resolve, 2000));
      
      modal.setConfirmLoading(false);
      modal.close();
    }, { once: true });
  }
  </script>
<% end %>

<%= render Ui::ExampleComponent.new(
  title: "确认对话框",
  description: "快速弹出确认框，通常用于删除等操作。",
  language: :erb,
  code: modal_confirm_code
) do %>
  <button onclick="showConfirm()" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors">
    Confirm Delete
  </button>

  <script>
  function showConfirm() {
    const modalHtml = `
      <%= ant_modal(
        title: "Are you sure?",
        id: "confirm-modal",
        open: true,
        ok_text: "Delete",
        cancel_text: "Cancel",
        destroy_on_close: true
      ) do %>
        <p class="text-red-600">This action cannot be undone.</p>
      <% end %>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    
    const modal = document.getElementById('confirm-modal');
    
    modal.addEventListener('ant--modal:ok', () => {
      console.log('Confirmed! Deleting...');
      modal.ant_modal_controller.close();
    });
    
    modal.addEventListener('ant--modal:cancel', () => {
      console.log('Cancelled');
    });
  }
  </script>
<% end %>

<%= render Ui::ExampleComponent.new(
  title: "不同尺寸",
  description: "Modal 提供了三种尺寸：small (400px)、middle (520px，默认) 和 large (800px)。",
  language: :erb,
  code: modal_sizes_code
) do %>
  <div class="flex gap-2">
    <%= ant_button "Small", onclick: "document.getElementById('small-modal').ant_modal_controller.open()" %>
    <%= ant_button "Middle (Default)", onclick: "document.getElementById('middle-modal').ant_modal_controller.open()" %>
    <%= ant_button "Large", onclick: "document.getElementById('large-modal').ant_modal_controller.open()" %>
  </div>

  <%= ant_modal(title: "Small Modal", id: "small-modal", size: :small) do %>
    <p>This is a small modal (400px)</p>
  <% end %>

  <%= ant_modal(title: "Middle Modal", id: "middle-modal", size: :middle) do %>
    <p>This is a middle modal (520px, default)</p>
  <% end %>

  <%= ant_modal(title: "Large Modal", id: "large-modal", size: :large) do %>
    <p>This is a large modal (800px)</p>
  <% end %>
<% end %>

<%= render Ui::ExampleComponent.new(
  title: "垂直居中",
  description: "使用 centered 属性让对话框垂直居中。",
  language: :erb,
  code: modal_centered_code
) do %>
  <button onclick="document.getElementById('centered-modal').ant_modal_controller.open()" 
          class="px-4 py-2 bg-[#1677ff] text-white rounded hover:bg-[#4096ff] transition-colors">
    Centered Modal
  </button>

  <%= ant_modal(title: "Centered Modal", id: "centered-modal", centered: true) do %>
    <p>This modal is vertically centered.</p>
  <% end %>
<% end %>

<%= render Ui::ExampleComponent.new(
  title: "禁用关闭",
  description: "设置 closable: false 隐藏关闭按钮，mask_closable: false 禁用点击遮罩关闭。",
  language: :erb,
  code: modal_no_close_code
) do %>
  <button onclick="document.getElementById('no-close-modal').ant_modal_controller.open()" 
          class="px-4 py-2 bg-[#1677ff] text-white rounded hover:bg-[#4096ff] transition-colors">
    No Close Button
  </button>

  <%= ant_modal(
    title: "No Close Button", 
    id: "no-close-modal", 
    closable: false, 
    mask_closable: false
  ) do %>
    <p>You must click Cancel or OK to close this modal.</p>
  <% end %>
<% end %>

<%= render Ui::ExampleComponent.new(
  title: "自定义按钮文字",
  description: "使用 ok_text 和 cancel_text 自定义按钮文字。",
  language: :erb,
  code: modal_custom_text_code
) do %>
  <button onclick="document.getElementById('custom-text-modal').ant_modal_controller.open()" 
          class="px-4 py-2 bg-[#1677ff] text-white rounded hover:bg-[#4096ff] transition-colors">
    Custom Button Text
  </button>

  <%= ant_modal(
    title: "Custom Button Text", 
    id: "custom-text-modal", 
    ok_text: "确定", 
    cancel_text: "取消"
  ) do %>
    <p>This modal has custom button text in Chinese.</p>
  <% end %>
<% end %>

<h3 class="text-xl font-bold text-gray-800 mb-4 mt-12 border-b pb-2 text-pink-600">API</h3>
<%= render Ui::ApiTableComponent.new do |api| %>
  <% api.row "title", "标题", "String", "nil" %>
  <% api.row "id", "对话框唯一标识 (用于 JS 调用)", "String", "自动生成" %>
  <% api.row "open", "对话框是否可见", "Boolean", "false" %>
  <% api.row "width", "宽度（自定义）", "String", "nil" %>
  <% api.row "size", "预设尺寸 (:small, :middle, :large)", "Symbol", ":middle" %>
  <% api.row "closable", "是否显示右上角的关闭按钮", "Boolean", "true" %>
  <% api.row "mask_closable", "点击蒙层是否允许关闭", "Boolean", "true" %>
  <% api.row "centered", "垂直居中展示 Modal", "Boolean", "false" %>
  <% api.row "ok_text", "确认按钮文字", "String", "OK" %>
  <% api.row "cancel_text", "取消按钮文字", "String", "Cancel" %>
  <% api.row "confirm_loading", "确定按钮 loading", "Boolean", "false" %>
  <% api.row "destroy_on_close", "关闭时销毁 Modal 里的子元素", "Boolean", "false" %>
<% end %>

<h4 class="font-bold text-gray-700 mt-10 mb-4 flex items-center">
  <span class="bg-gray-100 px-2 py-1 rounded text-pink-600 font-mono mr-2">Slots (插槽)</span>
</h4>
<%= render Ui::ApiTableComponent.new do |api| %>
  <% api.row "footer", "底部内容，用于自定义按钮", "Block", "Default OK/Cancel" %>
<% end %>

<h4 class="font-bold text-gray-700 mt-10 mb-4 flex items-center">
  <span class="bg-gray-100 px-2 py-1 rounded text-pink-600 font-mono mr-2">Methods (方法)</span>
</h4>
<%= render Ui::ApiTableComponent.new do |api| %>
  <% api.row "open()", "打开对话框", "-", "-" %>
  <% api.row "close()", "关闭对话框", "-", "-" %>
  <% api.row "setConfirmLoading(loading)", "设置确认按钮的加载状态", "Boolean", "-" %>
<% end %>

<h4 class="font-bold text-gray-700 mt-10 mb-4 flex items-center">
  <span class="bg-gray-100 px-2 py-1 rounded text-pink-600 font-mono mr-2">Events (事件)</span>
</h4>
<%= render Ui::ApiTableComponent.new do |api| %>
  <% api.row "ant--modal:open", "对话框打开时触发", "{ detail: { modal } }", "-" %>
  <% api.row "ant--modal:ok", "点击确定按钮时触发（可以 preventDefault 阻止关闭）", "{ detail: { modal } }", "-" %>
  <% api.row "ant--modal:cancel", "点击取消按钮时触发（可以 preventDefault 阻止关闭）", "{ detail: { modal } }", "-" %>
  <% api.row "ant--modal:close", "对话框关闭后触发", "{ detail: { modal } }", "-" %>
<% end %>

<h4 class="font-bold text-gray-700 mt-10 mb-4 flex items-center">
  <span class="bg-gray-100 px-2 py-1 rounded text-pink-600 font-mono mr-2">JavaScript API</span>
</h4>
<div class="bg-gray-50 p-4 rounded-lg">
  <pre class="text-sm"><code class="language-javascript">// 获取 Modal 控制器
const modal = document.getElementById('modal-id').ant_modal_controller;

// 打开对话框
modal.open();

// 关闭对话框
modal.close();

// 设置加载状态
modal.setConfirmLoading(true);

// 监听事件
document.getElementById('modal-id').addEventListener('ant--modal:ok', (event) => {
  event.preventDefault(); // 阻止默认关闭行为
  // 执行异步操作...
});</code></pre>
</div>
