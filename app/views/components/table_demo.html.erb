<%= render Ui::ComponentHeaderComponent.new(
  title: "Table äº¤äº’ç¤ºä¾‹",
  description: "å±•ç¤ºå¦‚ä½•ä½¿ç”¨ Table ç»„ä»¶çš„æ’åºã€ç­›é€‰å’Œè¡Œé€‰æ‹©åŠŸèƒ½ä¸åå°äº¤äº’ã€‚",
  when_to_use: ["éœ€è¦å¯¹è¡¨æ ¼æ•°æ®è¿›è¡Œæ’åº", "éœ€è¦ç­›é€‰ç‰¹å®šæ¡ä»¶çš„æ•°æ®", "éœ€è¦æ‰¹é‡æ“ä½œé€‰ä¸­çš„è¡Œ"]
) %>

<div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
  <h4 class="font-semibold text-blue-900 mb-2">ğŸ’¡ ä½¿ç”¨è¯´æ˜</h4>
  <ul class="text-sm text-blue-800 space-y-1">
    <li>â€¢ ç‚¹å‡» <strong>ID</strong> æˆ– <strong>Name</strong> åˆ—æ ‡é¢˜è¿›è¡Œæ’åºï¼ˆå‡åº â†’ é™åº â†’ æ— æ’åºï¼‰</li>
    <li>â€¢ é¼ æ ‡æ‚¬åœåœ¨ <strong>Role</strong> æˆ– <strong>Status</strong> åˆ—ï¼Œç‚¹å‡»ç­›é€‰å›¾æ ‡è¿›è¡Œç­›é€‰</li>
    <li>â€¢ å‹¾é€‰å¤é€‰æ¡†é€‰æ‹©è¡Œï¼Œé€‰ä¸­åä¼šåœ¨ä¸‹æ–¹æ˜¾ç¤ºæ‰¹é‡æ“ä½œå·¥å…·æ </li>
    <li>â€¢ æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹äº‹ä»¶å’Œå‚æ•°è¯¦æƒ…</li>
  </ul>
</div>

<div class="mb-4 p-3 bg-gray-100 rounded text-sm font-mono">
  <div><strong>å½“å‰æ’åº:</strong> <%= @sort_column.presence || "æ— " %> <%= @sort_direction == 'ascend' ? 'â†‘' : @sort_direction == 'descend' ? 'â†“' : '' %></div>
  <div><strong>ç­›é€‰æ¡ä»¶:</strong> 
    <%= "Role: #{@filter_role}" if @filter_role.present? %>
    <%= "Status: #{@filter_status}" if @filter_status.present? %>
    <%= "æ— " unless @filter_role.present? || @filter_status.present? %>
  </div>
  <div><strong>ç»“æœæ•°é‡:</strong> <%= @users.size %> æ¡</div>
</div>

<div data-controller="table-interactive-demo">
  <!-- æ‰¹é‡æ“ä½œå·¥å…·æ  -->
  <div data-table-interactive-demo-target="toolbar" 
       class="mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg hidden">
    <div class="flex items-center gap-4">
      <span class="font-semibold text-yellow-900" data-table-interactive-demo-target="selectionInfo">
        å·²é€‰æ‹© 0 é¡¹
      </span>
      <%= ant_button "æ‰¹é‡åˆ é™¤", 
                     size: :small,
                     color: :danger,
                     data: { action: "click->table-interactive-demo#deleteSelected" } %>
      <%= ant_button "æ‰¹é‡å¯¼å‡º", 
                     size: :small,
                     data: { action: "click->table-interactive-demo#exportSelected" } %>
      <%= ant_button "å–æ¶ˆé€‰æ‹©", 
                     size: :small,
                     data: { action: "click->table-interactive-demo#clearSelection" } %>
    </div>
  </div>

  <%= turbo_frame_tag "demo_table" do %>
    <%= ant_table(@users, 
                  row_selection: { get_row_key: ->(user) { user.id } }) do |t| %>
       <% t.column "ID", class: "w-16 font-mono", sortable: true do |u| %>
         <%= u.id %>
       <% end %>
       <% t.column "Name", class: "font-medium", sortable: true do |u| %>
         <%= u.name %>
       <% end %>
       <% t.column "Role", filterable: true, filters: [
            { text: "Developer", value: "Developer" },
            { text: "Designer", value: "Designer" },
            { text: "Manager", value: "Manager" }
          ] do |u| %>
         <%= ant_tag u.role %>
       <% end %>
       <% t.column "Status", filterable: true, filters: [
            { text: "Success", value: "success" },
            { text: "Processing", value: "processing" },
            { text: "Error", value: "error" }
          ] do |u| %>
         <%= ant_tag "Active", color: u.status %>
       <% end %>
       <% t.column "Email" do |u| %>
         <%= u.email %>
       <% end %>
       <% t.column "Action", class: "text-blue-600" do |u| %>
         <a href="#" class="hover:underline">ç¼–è¾‘</a> | 
         <a href="#" class="hover:underline text-red-600">åˆ é™¤</a>
       <% end %>
    <% end %>
  <% end %>
</div>

<div class="mt-8 p-4 bg-gray-50 rounded-lg">
  <h4 class="font-semibold text-gray-800 mb-3">å®ç°ä»£ç </h4>
  
  <div class="mb-4">
    <h5 class="text-sm font-semibold text-gray-700 mb-2">Stimulus Controller (JavaScript)</h5>
    <pre class="bg-white p-3 rounded border text-xs overflow-x-auto"><code>// app/javascript/controllers/table_interactive_demo_controller.js
import { Controller } from "@hotwired/stimulus"

export default class extends Controller {
  static targets = ["toolbar", "selectionInfo"]
  
  connect() {
    this.selectedIds = []
    this.setupEventListeners()
  }

  setupEventListeners() {
    this.element.addEventListener("ant--table:sort", this.handleSort.bind(this))
    this.element.addEventListener("ant--table:filter", this.handleFilter.bind(this))
    this.element.addEventListener("ant--table:filterClear", this.handleFilterClear.bind(this))
    this.element.addEventListener("ant--table:selectionChange", this.handleSelection.bind(this))
  }

  handleSort(event) {
    const { column, direction } = event.detail
    console.log("ğŸ“Š æ’åº:", { column, direction })
    
    const url = new URL(window.location)
    url.searchParams.set('sort_column', column)
    url.searchParams.set('sort_direction', direction)
    
    // ä½¿ç”¨ Turbo Frame å±€éƒ¨åˆ·æ–°
    Turbo.visit(url.toString(), { frame: "demo_table" })
  }

  handleFilter(event) {
    const { column, value } = event.detail
    console.log("ğŸ” ç­›é€‰:", { column, value })
    
    const url = new URL(window.location)
    url.searchParams.set(\`filter_\${column}\`, value)
    Turbo.visit(url.toString(), { frame: "demo_table" })
  }

  handleFilterClear(event) {
    const { column } = event.detail
    console.log("ğŸ—‘ï¸ æ¸…é™¤ç­›é€‰:", { column })
    
    const url = new URL(window.location)
    url.searchParams.delete(\`filter_\${column}\`)
    Turbo.visit(url.toString(), { frame: "demo_table" })
  }

  handleSelection(event) {
    this.selectedIds = event.detail.selectedRows
    console.log("âœ… é€‰ä¸­è¡Œ:", this.selectedIds)
    
    if (this.selectedIds.length > 0) {
      this.showToolbar()
    } else {
      this.hideToolbar()
    }
  }

  showToolbar() {
    this.toolbarTarget.classList.remove('hidden')
    this.selectionInfoTarget.textContent = \`å·²é€‰æ‹© \${this.selectedIds.length} é¡¹\`
  }

  hideToolbar() {
    this.toolbarTarget.classList.add('hidden')
  }

  deleteSelected() {
    alert(\`å°†åˆ é™¤é€‰ä¸­çš„ \${this.selectedIds.length} é¡¹: \${this.selectedIds.join(', ')}\`)
    // å®é™…é¡¹ç›®ä¸­å‘é€ DELETE è¯·æ±‚
    // fetch('/users/batch_delete', { method: 'DELETE', ... })
  }

  exportSelected() {
    console.log("ğŸ“¥ å¯¼å‡ºé€‰ä¸­é¡¹:", this.selectedIds)
    alert(\`å°†å¯¼å‡ºé€‰ä¸­çš„ \${this.selectedIds.length} é¡¹\`)
  }

  clearSelection() {
    // å–æ¶ˆæ‰€æœ‰å¤é€‰æ¡†
    const checkboxes = this.element.querySelectorAll('input[type="checkbox"]')
    checkboxes.forEach(cb => {
      cb.checked = false
      cb.dispatchEvent(new Event('change', { bubbles: true }))
    })
  }
}</code></pre>
  </div>

  <div>
    <h5 class="text-sm font-semibold text-gray-700 mb-2">Controller (Ruby)</h5>
    <pre class="bg-white p-3 rounded border text-xs overflow-x-auto"><code># app/controllers/components_controller.rb
def table_demo
  @sort_column = params[:sort_column]
  @sort_direction = params[:sort_direction]
  @filter_role = params[:filter_Role]
  @filter_status = params[:filter_Status]
  
  # è·å–æ•°æ®
  @users = get_users_data
  
  # åº”ç”¨ç­›é€‰
  @users = @users.select { |u| u.role == @filter_role } if @filter_role.present?
  @users = @users.select { |u| u.status.to_s == @filter_status } if @filter_status.present?
  
  # åº”ç”¨æ’åº
  if @sort_column.present? && @sort_direction != 'none'
    @users = @users.sort_by { |u| u.send(@sort_column.downcase.to_sym) }
    @users.reverse! if @sort_direction == 'descend'
  end
  
  render "table_demo"
end</code></pre>
  </div>
</div>
